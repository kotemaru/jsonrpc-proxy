<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Logger</title>

<link rel="stylesheet" href="/css/BorderLayout.css" />

<script src="/js/jquery-1.8.2.js"></script>
<script src="/js/socket.io.js"></script>

<style>
* {
	box-sizing: border-box;
}

#borderLayoutHeader {
	border: 2px solid #888888;
	overflow-y: scroll;
}
#logs {
}

#logs div {
	font-size: 14px;
	cursor: pointer;
	padding: 2px;
}

#logs div:hover {
	background: #f0f0f0;
}

iframe {
	width: 50%;
	height: 100%;
	float: left;
}
</style>

<script>
	var socket = io.connect('http://localhost:8080/?channel=filter.log');
	socket.on('connect', function(msg) {
		console.log("connet");
		$("#connect").show();
	});
	socket.on('disconnect', function(msg) {
		console.log("disconnet");
		$("#connect").hide();
	});
	socket.on('filter.apply', function(msg) {
		console.log("message");
		var $item = $("<div onClick='selectLog(this)'>" + msg.datetime + " :" + msg.id + ":" + msg.method + "</div>");
		$item.data("log", msg);
		$("#logs").append($item);
		$("#borderLayoutHeader").scrollTop( $("#logs").height() - $("#borderLayoutHeader").height() );
	});

	function SendMsg() {
		var msg = document.getElementById("message").value;
		socket.emit('message', {
			value : msg
		});
	}
	function DisConnect() {
		var msg = socket.id + "は切断しました。";
		socket.emit('message', {
			value : msg
		});
		socket.disconnect();
	}

	function selectLog(elem) {
		var $item = $(elem);
		var log = $item.data("log");
		$("#request").attr("src", log.request);
		$("#response").attr("src", log.response);
	}

	$(function() {
		var headerHeight = "150px";
		$("#borderLayoutHeader").css("height", headerHeight);
		$("#borderLayoutLeft").css("width", "0px");
		$("#borderLayoutRight").css("width", "0px");
		$("#borderLayoutMain").css({
			"padding-top" : headerHeight,
			"padding-left" : "0px",
			"padding-right" : "0px"
		});

		var path = location.search.substr(1);

		$.ajax({
			type : "GET",
			dataType : "text",
			url : path,
			success : function(text) {
				$("#editor").val(text);
			}
		});
	});
</script>

</head>
<body>
	<div id="header"></div>
	<div id="main"></div>

	<div id="borderLayoutMain" class="BorderLayoutFrame">
		<iframe id="request"></iframe>
		<iframe id="response"></iframe>
	</div>

	<div id="borderLayoutLeft" class="BorderLayoutFrame"></div>

	<div id="borderLayoutRight" class="BorderLayoutFrame"></div>

	<div id="borderLayoutHeader" class="BorderLayoutFrame">
		<div id="logs">

		</div>
	</div>

	<div id="borderLayoutFooter" class="BorderLayoutFrame"></div>
</body>
</html>
